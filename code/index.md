# 内部-Code规范


## CR 有感
前段时间参与了xx代码 Code Review，开始前大家有些不安，觉得代码水平很难评判，详细研究了各个评分纬度，但实际 Review 下来发现评判特别简单，大家给的分数高度一致，总结下自己的感受：

- 功夫在日常，代码质量很难刷
  - 最基础的规范都不注意会让评委对后续的 Review 内容带有挑战心态，一屋不扫，何以扫天下
  - 注意小细节优化的同学一般整体代码规范性会很高
  - 相对于发起一个重构的项目，重构在日常是个非常可贵的品质，很关项目需要重构，正是因为日常没有做好 Code Review，导致代码腐化，团队效能下降
- 清理无用代码、主动升级依赖、使用新特性 等让人印象深刻
- README 质量高的项目，代码质量通常不会差，对自己的作品在意会体现在方方面面
- 代码质量分布通常会团队化，不要指望个别优秀的同学带动团队的整体水平提升;

- 与Code Review，技术文化需要主管以身作则
自己在团队 Review 前端代码总结了几类常见的问题

 ### 规范类问题
- 无意义的commit message； 建议所有同学了解一下看看 `commit message 规范`。
### 无用和缺省的依赖
> mvn dependency:analyze

## git commit message 格式
> ‹type> ( < scope > ) : ‹subject>
### type(必须）
用于说明git commit的类别，只允许使用下面的标识
- feat: 新功能 (feature)
- fix/to：修复bug，可以是QA发现的BUG，也可以是研发自己发现的BUG
  - fix：产生diff并自动修复此问题。适合于一次提交直接修复问题(可以和Aone bug关联）
  - to：只产生dif不自动修复此问题。适合于多次提交。最终修复问题提交时使用fix(可以和Aone bug关联）
- docs: 文档 (documentation)
- style：格式（不影响代码运行的变动）
- refactor：重构（即不是新增功能，也不是修改bug的代码变动）
- pert： 优化相关，比如提升性能、体验
- test：增加测试
- chore：构建过程或辅助工具的变动
- revert：回滚到上一个版本
- merge: 代码合并
- sync: 同步主线或分支的Bug

### scope(可选)
scope用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。
如果你的修改影响了不止一个scope，你可以使用*代替。

###  subject(必选)
subject是commit目的的简短描述，不超过50个字符。
- 建议使用中文(中国人用中文描述问题能更清楚一些）
- 结尾不加句号或其他标点符号
- 根据以上规范git commit message 将是如下的格式：
```shell
 fix(DA0): 活动查询缺少子活动类型属性
 feat (Controller): 活动查询接口开发
```  
  
以上就是我们梳理的git commit规范，那么我们这样规范git commit到底有哪些好处呢？
- 便于程序员对提交历史进行追湖，了解发生了什么情况
- 一旦约束了commit message，意味着`我们将慎重的进行每一次提交，不能再一股脑的把各种各样的改动都放在一个git commit里面`，这样一来整个代码改动的历史也将更加清晰
- 格式化的commit message才可用于自动化输出 change log



## Code Review的一些想法
### 1. 统一认知
- Code Review 不是判定 Coding 水平高低，只要频度够任何人都不会尴尬
- CR 是互相帮助的过程，但同时也是互相学习的过程，因此发起 CR 尽量抄送相关同学
- CR 不只是为了发现有问题的代码，更重要的意义是集思广益写出更好的代码，对待可以 work 但有瑕疵的代
码要警惕破窗效应
- 通过 CR 要让所有人了解团队代码规范，学习更优秀的代码书写；同时发现团队通用问题，优化工具、流程

### 2. Code Review 作用
- 统一团队编码规范
- 提升团队代码质量
- 分享项目知识，了解团队技术变更、发展
- 统一团队技术价值观，构建更好的软件、更好的团队

### 3. Code Review 关注点
#### 3.1 可读性 ＆ 可维护性
- 文件位置 &命名，变量使用、空格 or tab 等是否遵从了团队的统一规范？
- 宇段、变量、参数、方法、类的命名是否真实反映它们所代表的事物？
- 我是否可以通过读代码理解它做了什么？
- 错误信息、异常分支是否可被理解？
- 不清晰的代码是否被文档、注释或容易理解的测试用例所覆盖？
#### 3.2 逻辑实现合理
- 代码是否真的达到了预期的目标？
- 代码看上去是否包含不明显的 bug，比如使用错误的变量进行检查？
- 是否有自动化测试来确保代码的正确性，测试的代码是否真的可以验证代码达到了协定的需求？
#### 3.3 是否考虑过？
- 是否需要满足相关监管需求？
- 是否需要创建公共文档或修改现存的帮助文档？
- 是否有会在生产环境中导致应用停止运行的明显错误？
- 代码是否会错误地指向测试环境？
- 是否存在应在真实服务中移除的硬编码代码？
- 对性能的需求是什么？
- 是否考虑了安全问题？
### 4. Code Review 之后
1. 互相学习，见贤思齐，见不贤而内自省 
2. 抽象共性问题，找出解决方案，让团队变的更好
   
3. 典型实践 
   1. 形成规范：阿里巴巴 Java 开发手册
   2. 自动校验工具；
