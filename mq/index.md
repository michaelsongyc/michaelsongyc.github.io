# 中间件-消息(MQ)



## 什么是消息中间件
- 消息队列 (MQ全称: Message Queue) 是应用程序和应用程序之间的通信方法。
- MQ关注于数据的发送和接收，利用高效、可靠的异步消息传递机制集成分布式系统。通过提供消息传递和消息排队模型，它可以在分布式环境下扩展进程间的通信。

## 为什么需要消息中间件

&emsp;&emsp;在项目中，可将一些无需即时返回且耗时的操作提取出来，进行`异步处理`，这种异步处理的方式大大的节省了服务器的请求响应时间，最终提高了系统的`吞吐量`。

### 系统解耦
&emsp;&emsp;MQ相当于一个中介，生产方通过MQ与消费方交互，它将应用程序进行解耦合。

&emsp;&emsp;使用MQ后，系统就把自己的一份核心数据发到MQ里，下游哪个系统需要就自己去消费，不需要的话，不用消费即可。

### 异步调用
&emsp;&emsp;将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。提高了应用程序的响应时间。

### 流量削峰

&emsp;&emsp;假设你有一个系统，平时正常的时候每秒可能就几十个请求，系统正常处理都是OK的，每秒几百请求是可以轻松抗住的；
但假设在高峰期每秒钟有上万个请求，瞬间出现了流量高峰，此时你的选择是要搞扩容机器，能否抗住这个瞬时高峰吗？

此时我们就可以用MQ中间件来进行流量削峰。所有机器前面部署一层MQ，平时每秒几百请求大家都可以轻松接收消息。
一旦到了瞬时高峰期，一下涌入每秒几万的请求，就可以积压在MQ里面，然后用机器慢慢的消费和处理。

这个就是很典型的一个MQ的用法，用有限的机器资源承载高并发请求，如果业务场景允许异步削峰，高峰期积压一些请求在MQ里，然后高峰期过了，后台系统在一定时间内消费完毕不再积压的话，那就很适合用这种技术方案。

## 常见的消息中间件有哪些
### RocketMQ
阿里系下开源的一款分布式、队列模型的消息中间件，原名Metaq，后来3.0版本改为RocketMQ，是阿里参照kafka设计思想使用java实现的一套mq。同时将阿里系内部多款mq产品（Notify、metaq）进行整合，只维护核心功能，去除了所有其他运行时依赖，保证核心功能最简化，在此基础上配合阿里上述其他开源产品实现不同场景下mq的架构，目前主要多用于订单交易系统。
具有以下特点：
- 能够保证严格的消息顺序
- 提供针对消息的过滤功能
- 提供丰富的消息拉取模式
- 高效的订阅者水平扩展能力
- 实时的消息订阅机制
- 亿级消息堆积能力

### Kafka
Apache下的一个子项目，使用scala实现的一个高性能分布式Publish/Subscribe消息队列系统，具有以下特性：
- 快速持久化：通过磁盘顺序读写与零拷贝机制，可以在O(1)的系统开销下进行消息持久化；
- 高吞吐：在一台普通的服务器上既可以达到10W/s的吞吐速率；
- 高堆积：支持topic下消费者较长时间离线，消息堆积量大；
- 完全的分布式系统：Broker、Producer、Consumer都原生自动支持分布式，依赖zookeeper自动实现负载均衡；
- 支持Hadoop数据并行加载：对于像Hadoop的一样的日志数据和离线分析系统，但又要求实时处理的限制，这是一个可行的解决方案。


## 各种MQ之间的比较
